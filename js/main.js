function iconSelector(e,a){a=parseInt(a);var c="";switch((e=e.toLocaleLowerCase())+""+a){case"co5":case"co6":case"co2":c="-48px 0px";break;case"bde15":case"bdi15":case"bde45":case"bdi45":case"bdr45":case"fc10":case"par15":case"par18":case"bdr15":c="124px 0px";break;case"par16":case"par20":c="172px -188px";break;case"par10":case"par19":c="125px -188px";break;case"par13":case"bde22":case"bdi22":case"bdr22":case"fc1":case"fc47":case"par40":c="-190px -188px";break;case"bde41":case"bdi41":case"bde66":case"bdi66":case"bdr66":case"fc8":case"bde49":case"bdi49":case"bdr49":case"bde85":case"bdi85":case"bdr85":case"est1":case"est2":case"est3":case"est4":case"est5":case"est6":case"est9":case"bde57":case"bdi57":case"bdr57":case"bde58":case"bdi58":case"bdr58":case"bde59":case"bdi59":case"bdr59":case"bde84":case"bdi84":case"bdr84":case"bde46":case"bdi46":case"par24":case"bdr46":case"bde87":case"bdi87":case"bdr87":case"bde86":case"bdi86":case"bdr86":case"bde32":case"bdi32":case"bdr32":case"fc2":case"bde56":case"bdi56":case"bdr56":case"fc42":case"bde42":case"bdi42":case"bdr42":case"bde14":case"bdi14":case"bdr14":case"bde9":case"bde69":case"bdi9":case"bdi69":case"bdr9":case"bdr69":case"bde38":case"bdi38":case"bdr38":case"bdr64":case"bde55":case"bdi55":case"bdr55":case"blq1":case"blq5":case"blq11":case"blq21":case"blq22":case"bdr79":case"bde79":case"co14":case"co3":case"blq61":case"blq44":case"blq54":case"blq24":case"co10":case"par27":case"fc55":case"bde61":case"bdi61":case"bdr61":case"bde53":case"bdi53":case"bdr53":case"fc3":case"co13":case"co11":case"blq31":case"co1":case"fc11":case"bdr41":c="-238px -141px";break;case"bde5":case"bde39":case"bdi5":case"bdi39":case"bdr5":case"bdr39":case"bde33":case"bdi33":case"bdr33":case"bde34":case"co9":case"bdi34":case"blq4":case"blq41":case"blq42":case"bde4":case"bdi4":case"bdr4":case"blq30":case"bde35":case"bde36":case"bdi35":case"bdi36":case"bdr35":case"bdr36":case"bde7":case"bde8":case"bde19":case"bdi7":case"bdi8":case"bdi19":case"bdr7":case"bdr8":case"bdr19":case"fc4":case"bde30":case"bdi30":case"bdr30":case"bde47":case"bdi47":case"bdr47":case"bde25":case"bdi25":case"bdr25":case"fc7":case"bdr34":c="2px -92px";break;case"bde83":case"bdi83":case"bde26":case"bdi26":case"bdr26":case"par26":case"bde50":case"bde51":case"bde52":case"bdi50":case"bdi51":case"bdi52":case"bdr50":case"bdr51":case"bdr52":case"fc51":case"bde43":case"bdi43":case"bdr43":case"bde71":case"bdi71":case"bdr71":case"bde72":case"bdi72":case"bdr72":case"bde73":case"bdi73":case"bdr73":case"bde74":case"bdi74":case"bdr74":case"bde76":case"bdi76":case"bdr76":case"bde75":case"bdi75":case"bdr75":case"bde13":case"bdi13":case"bdr13":case"blq51":case"bde82":case"bdi82":case"bdr82":case"bde80":case"bde98":case"bdi80":case"bdr80":case"bdi98":case"bde62":case"bdi62":case"bdr62":case"bde28":case"bdi28":case"bdr28":case"bde37":case"bdi37":case"bdr37":case"bde3":case"bde12":case"bdi3":case"bdi12":case"bdr3":case"bdr12":case"fc9":case"par25":case"fc41":case"bdr83":c="-286px -92px";break;case"bde54":case"bdi54":case"bdr54":case"par23":case"fc31":case"par32":case"co12":case"co7":case"bde44":case"bdi44":case"bdr44":case"par11":case"par17":case"bde77":case"bdi77":case"bdr77":case"ldi1":case"ldi3":case"ldi4":case"bde60":case"bdi60":case"bdr60":case"par12":c="30px -140px";break;case"bde2":case"bde18":case"bde20":case"bde21":case"bdi2":case"bdi18":case"bdi20":case"bdi21":case"bdr2":case"bdr18":case"bde10":case"bdi10":case"bdr10":case"bdr20":case"bde29":case"bdi29":case"bdr29":case"bde89":case"bdi89":case"bdr89":case"bdr21":c="30px 130px";break;case"bde6":case"bdi6":case"bdr6":case"bde40":case"bdi40":case"bdr40":case"bde81":case"bdi81":case"bde48":case"bdi48":case"bdr48":case"bdr81":c="318px 130px";break;case"fc13":case"fc19":case"fc12":case"fc35":case"fc37":case"fc32":case"fc33":case"fc24":case"fc34":case"par22":case"par21":c="270px 130px";break;case"po1":case"po9":c="-96px -48px";break;case"par28":c="366px 32px";break;case"bde1":case"bde67":case"bde70":case"bdi1":case"bdi67":case"bdi70":case"bdr1":case"bdr67":case"bde23":case"bdi23":case"bdr23":case"bde68":case"bdi68":case"bdr68":case"par42":case"par34":case"bde24":case"bdi24":case"bdr24":case"ldi2":case"c08":case"bdr70":c="-48px -46px";break;case"bdr31":case"par31":case"par33":case"bdr63":case"par14":case"par30":case"par41":case"fc26":c="318px 77px";break;case"do1":case"do2":case"ro1":case"fc29":case"fc27":case"ldi11":case"ldi13":case"co4":case"ldi14":c="-94px -190px";default:"-288px -47px"}return c}
      function getData(rastreio){
        $("header").addClass("top");
        $(".loading-animation").addClass("visible");
        $.ajax({
            type: "POST",
            url: "https://correios.contrateumdev.com.br/api/rastreio",
            data: JSON.stringify({"code":rastreio.replace(/ /g,''),"type":"LS"}),
            dataType:"json",
            contentType: 'application/json',
            success: function(response){
                $("#rastreios").fadeIn('100');
                populateResult(response);
                $(".loading-animation").removeClass("visible");                                        
            }
        });
      }
      function showVersion(response){
            $("#appVersion").text(response[0].tag_name);
      }
      function getVersion(){
            $.ajax({
              type: "GET",
              url: "https://api.github.com/repos/matheuspaula19/meupacote/releases",
              success: function(response){
                showVersion(response)
              }
          });
      }
      function getLocation(q){
        $('#mapModal').modal('show');
          $.ajax({
              type: "GET",
              url: "https://nominatim.openstreetmap.org/search.php?q="+q+"&format=jsonv2",
              success: function(response){
                if(response.length > 0){
                  getMiniatureMap(response[0].lat,response[0].lon);
                  $('#mapModalEnd').text(response[0].display_name);
                }
              }
          });
      }
      function getMiniatureMap(lat,lon){
        $("#mapPlaceholder").html("");
        map = new OpenLayers.Map("mapPlaceholder");
        map.addLayer(new OpenLayers.Layer.OSM());
        const packageIco = "data:image/png;base64,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";
        var lonLat = new OpenLayers.LonLat(lon,lat).transform(new OpenLayers.Projection("EPSG:4326"),map.getProjectionObject()),
        markers = new OpenLayers.Layer.Markers("Markers"),
        size = new OpenLayers.Size(48,48),
        offset = new OpenLayers.Pixel(-(size.w/2), -size.h),
        icon = new OpenLayers.Icon(packageIco, size, offset);
        map.addLayer(markers);
        markers.addMarker(new OpenLayers.Marker(lonLat,icon));
        map.setCenter (lonLat, 18);
      }
      function notNull(v){
        return (v!== null && v !== undefined) ? v : "";
      }
      function populateResult(res){
        var body = "";
        for(var i = 0;i < res.objeto.length;i++){
            var obj = res.objeto[i], events = "";
            if(!obj.categoria.includes("ERRO:")){
              for(var j = 0;j < obj.evento.length;j++){
                var event = obj.evento[j];
                events += populateStatus(event);
              }
              body += "<div class=\"card text-left mb-3\"><div class=\"card-header\">"+obj.categoria+" | "+obj.nome+"</div><div class=\"card-body\"><h5 class=\"card-title mb-4\">"+obj.numero+"</h5><div class=\"eventos\">"+events+"</div></div><div class=\"card-footer text-muted\">Última atualização: "+obj.evento[0].data+" - "+obj.evento[0].hora+"</div></div>";
            }else{
              body += populateError(obj);
            }
        }
        $("#rastreios").html(body);
      }
      function populateStatus(event){
        return "<div data-event=\""+event.tipo+event.status+"\" class=\"status_event card mb-2\"><div class=\"card-body justify-content-between d-flex\"><div><div class=\"status_icon\" style=\"background-position:"+iconSelector(event.tipo,event.status)+"\"></div><h6>"+event.descricao+"</h6><div>"+(event.unidade !== undefined ? "<span>De: </span><span>"+event.unidade.local+"</span>" : "")+(event.unidade.endereco.cep !== undefined ? "<div><span>Endereço: </span><span>"+event.unidade.endereco.bairro+" - "+event.unidade.endereco.uf+" | "+event.unidade.endereco.cep+" | "+event.unidade.endereco.logradouro+"</span></div>" : "")+"</div>"+
          (event.destino !== undefined ? "<div><span>Para: </span><span>"+event.destino[0].local+"</span>"+(event.destino[0].endereco.cep !== undefined ? "<div><span>Endereço: </span><span>"+notNull(event.destino[0].endereco.bairro)+" - "+notNull(event.destino[0].endereco.uf)+" | "+notNull(event.destino[0].endereco.cep)+" | "+notNull(event.destino[0].endereco.logradouro)+"</span></div>" : "")+"</div>":"")+"</div>"+(exists(OpenLayers) ? "<div class=\"showMap\" data-end=\""+notNull(event.unidade.endereco.cep)+" "+notNull((event.unidade.endereco.cep == null || event.unidade.endereco.cep == undefined) ? event.unidade.local :"")+" "+notNull(event.unidade.endereco.bairro)+" "+notNull(event.unidade.endereco.localidade)+"\"></div>":"")+"</div><div class=\"card-footer text-muted d-flex\"><span class=\"clock\"></span>"+event.data+" - "+event.hora+"</div></div>";        
      }
      function exists(o){
        return (typeof o === 'undefined' || o === null) ? false:true;
      }
      function populateError(event){
        return "<div class=\"card text-left\"><div class=\"card-header\">"+event.numero+"</div><div class=\"card-body\"><h5 class=\"card-title mb-4\"></h5><div class=\"eventos\">"+"<div class=\"error_event card mb-2\"><div class=\"card-body\"><div class=\"status_icon\" style=\"background-position:33px -98px\"></div><h6>"+event.categoria.split(":")[1].trim()+"</h6><div></div></div></div></div></div>";
      }
      $(function(){
        $("body").on("click",".showMap",function(e){
          getLocation($(this).attr("data-end"));
        });
        $("#track-form").on("submit",function(e){
          e.preventDefault();
          $("#rastreios").fadeOut('50');
          var value = $("#codigo").val();
          if(value.length > 12){
            getData(value);
          }
        });
        getVersion();
      });
